<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mangrove Innovator Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #F0FDF4; }
        .game-screen { display: none; }
        .active-screen { display: block; }
        .modal-backdrop { background-color: rgba(0,0,0,0.6); }
        .map-pin { transition: transform 0.2s ease-in-out, filter 0.2s; }
        .map-pin:hover { transform: scale(1.1); filter: drop-shadow(0 0 10px #fde047); }
        .plant-card, .idea-card { transition: transform 0.2s, box-shadow 0.2s; }
        .plant-card:hover, .idea-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        .plant-card-draggable { cursor: grab; }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }
        @keyframes scanner-pulse { 0%, 100% { box-shadow: 0 0 15px rgba(52,211,153,0.8); } 50% { box-shadow: 0 0 25px 5px rgba(52,211,153,1); } }
        @keyframes scanner-sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .scanner-active .scanner-line { opacity: 1; animation: scanner-sweep 1.5s infinite linear; }
        .scanner-active .scanner-lens { animation: scanner-pulse 1.5s infinite; }
        .scanner-line { opacity: 0; transition: opacity 0.3s ease-in-out; }
        .notification { animation: slide-in 0.5s ease-out forwards, slide-out 0.5s ease-in 3.5s forwards; transform: translateX(120%); }
        @keyframes slide-in { from { transform: translateX(120%); } to { transform: translateX(0); } }
        @keyframes slide-out { from { transform: translateX(0); } to { transform: translateX(120%); } }
        .match-item { cursor: pointer; transition: background-color 0.2s; }
        .match-item.selected { background-color: #fde047; border-color: #facc15; }
        .match-item.matched { background-color: #dcfce7; border-color: #4ade80; cursor: not-allowed; opacity: 0.7; }
        .combo-slot { transition: background-color 0.2s, border-color 0.2s; }
        .combo-slot.drag-over { background-color: #dcfce7; border-color: #4ade80; }
        .avatar { width: 80px; height: 80px; border-radius: 50%; cursor: pointer; border: 4px solid transparent; transition: border-color 0.2s, box-shadow 0.2s; position: relative; overflow: hidden; }
        .avatar:hover { border-color: #a7f3d0; }
        .avatar.selected { border-color: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.5); }
        .avatar-1 { background-color: #3b82f6; } .avatar-1::before { content: ''; position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; border: 4px solid white; border-top: none; border-radius: 0 0 10px 10px; } .avatar-1::after { content: ''; position: absolute; top: 25%; left: 50%; transform: translateX(-50%); width: 48px; height: 8px; border: 4px solid white; border-bottom: none; border-radius: 5px 5px 0 0; }
        .avatar-2 { background-color: #f97316; } .avatar-2::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; border: 4px solid white; border-radius: 50%; } .avatar-2::after { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 20px solid white; transform: translate(-50%, -80%) rotate(45deg); }
        .avatar-3 { background-color: #eab308; } .avatar-3::before { content: ''; position: absolute; top: 20%; left: 50%; transform: translateX(-50%); width: 30px; height: 30px; background: white; border-radius: 50%; } .avatar-3::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translateX(-50%); width: 16px; height: 10px; background: #6b7280; }
        .avatar-4 { background-color: #22c55e; } .avatar-4::before { content: ''; position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; background: white; border-radius: 0 50% 0 50%; transform: translate(-50%, -50%) rotate(-45deg); }
        .css-plant-container { position: relative; width: 100%; height: 100%; transform: scale(0.9); } .css-plant-container div { position: absolute; } .plant-‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å .trunk { width: 10px; height: 70%; background: #654321; bottom: 0; left: 50%; transform: translateX(-50%); } .plant-‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å .root1 { width: 6px; height: 50%; background: #654321; bottom: 0; left: 50%; border-radius: 50% 0; transform: translateX(-20px) rotate(-40deg); } .plant-‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å .root2 { width: 6px; height: 50%; background: #654321; bottom: 0; left: 50%; border-radius: 0 50%; transform: translateX(14px) rotate(40deg); } .plant-‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å .leaves { width: 60px; height: 60px; background: #15803d; border-radius: 50%; top: 5%; left: 50%; transform: translateX(-50%); }
        .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .trunk { width: 12px; height: 60%; background: #78716c; bottom: 0; left: 50%; transform: translateX(-50%); border-radius: 5px 5px 0 0; } .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .leaves { width: 80px; height: 80px; background: #65a30d; border-radius: 50%; top: 0; left: 50%; transform: translateX(-50%); } .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt1, .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt2, .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt3 { width: 4px; height: 4px; background: white; border-radius: 50%; } .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt1 { top: 20%; left: 40%; } .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt2 { top: 30%; left: 60%; } .plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏• .salt3 { top: 40%; left: 30%; }
        .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .stem { width: 8px; height: 80%; background: #166534; bottom: 0; left: 50%; transform: translateX(-50%); } .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .leaf1, .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .leaf2 { width: 50px; height: 20px; background: #22c55e; border-radius: 50% 0; } .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .leaf1 { bottom: 20%; left: 50%; transform: translateX(-100%) rotate(20deg); } .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .leaf2 { bottom: 40%; left: 50%; transform: rotate(-20deg) scaleX(-1); } .plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á .flower { width: 25px; height: 25px; background: #9333ea; border-radius: 50% 50% 0 50%; top: 10%; left: 50%; transform: translateX(-50%) rotate(45deg); }
    </style>
</head>
<body class="text-gray-800">

    <div id="notification-container" class="fixed top-5 right-5 z-50 space-y-2 w-72"></div>

    <div id="game-container" class="container mx-auto p-2 sm:p-4 max-w-5xl">
        <header id="game-header" class="hidden sticky top-0 bg-white/80 backdrop-blur-sm z-10 p-4 rounded-xl shadow-md mb-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 md:gap-2">
                <div class="flex items-center gap-3"><div id="header-avatar" class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-md bg-gray-400 flex-shrink-0"></div><div><h2 class="text-lg sm:text-xl font-bold text-green-800">‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£: <span id="player-name-display"></span></h2><p class="text-xs sm:text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô Mangrove Innovation Lab (MIL)</p></div></div>
                <div class="flex justify-around w-full md:w-auto space-x-2">
                    <div class="text-center text-xs sm:text-base"><p class="font-semibold">üëÅÔ∏è ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï</p><p>Lv. <span id="obs-lvl">1</span> (<span id="obs-xp">0</span>/100 XP)</p></div>
                    <div class="text-center text-xs sm:text-base"><p class="font-semibold">üî¨ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p><p>Lv. <span id="anl-lvl">1</span> (<span id="anl-xp">0</span>/100 XP)</p></div>
                    <div class="text-center text-xs sm:text-base"><p class="font-semibold">üí° ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</p><p>Lv. <span id="crt-lvl">1</span> (<span id="crt-xp">0</span>/100 XP)</p></div>
                </div>
            </div>
        </header>

        <div id="welcome-screen" class="game-screen active-screen text-center bg-white p-6 sm:p-8 rounded-xl shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-bold text-green-700 mb-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£</h1><p class="text-gray-600 mb-8">Mangrove Innovation Lab (MIL)</p>
            <div class="max-w-md mx-auto">
                <div class="text-left mb-4"><label for="player-name-input" class="block font-semibold mb-2">1. ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label><input type="text" id="player-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></div>
                <div class="text-left mb-6"><label class="block font-semibold mb-2">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß:</label><div id="avatar-selection" class="flex justify-center gap-4"></div></div>
                <div class="space-y-2"><button id="start-game-btn" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button><button id="continue-game-btn" class="w-full bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors hidden">‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</button></div>
            </div>
        </div>
        
        <div id="professor-modal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-lg shadow-2xl p-6 sm:p-8 max-w-md w-full mx-4 animate-fade-in-up">
                <h2 id="professor-title" class="text-2xl font-bold text-green-800 mb-4">‡∏™‡∏≤‡∏£‡∏à‡∏≤‡∏Å ‡∏®.‡∏≠‡∏£‡∏£‡∏ñ‡∏ä‡∏±‡∏¢</h2><p id="professor-message" class="text-gray-700 mb-6"></p><button id="professor-continue-btn" class="bg-green-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-green-700 transition-colors">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
            </div>
        </div>

        <div id="map-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 1: The Explorer</h2><p class="text-center text-gray-600 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏õ‡πà‡∏≤‡∏ä‡∏≤‡∏¢‡πÄ‡∏•‡∏ô</p>
            <div class="bg-gradient-to-br from-blue-300 to-green-400 rounded-lg p-4 relative aspect-[16/9] flex items-center justify-center">
                <div class="w-full h-full relative">
                    <div class="absolute inset-0 bg-blue-500 rounded-md"></div><div class="absolute top-1/4 left-0 w-3/4 h-1/2 bg-emerald-700 rounded-r-full"></div><div class="absolute top-1/3 right-[15%] w-1/5 h-1/4 bg-amber-500 rounded-full"></div>
                    <div id="zone-morphology" data-zone="Morphology" class="absolute top-[30%] left-[25%] cursor-pointer map-pin"><span class="text-3xl sm:text-4xl">üå≥</span><div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white px-2 py-1 rounded-md shadow text-[10px] sm:text-xs font-semibold whitespace-nowrap">‡∏õ‡πà‡∏≤‡∏ä‡∏≤‡∏¢‡∏ù‡∏±‡πà‡∏á</div></div>
                    <div id="zone-property" data-zone="Property" class="absolute top-[55%] left-[50%] cursor-pointer map-pin"><span class="text-3xl sm:text-4xl">üíß</span><div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white px-2 py-1 rounded-md shadow text-[10px] sm:text-xs font-semibold whitespace-nowrap">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≥‡∏Å‡∏£‡πà‡∏≠‡∏¢</div></div>
                    <div id="zone-behavior" data-zone="Behavior" class="absolute top-[40%] left-[75%] cursor-pointer map-pin"><span class="text-3xl sm:text-4xl">üèùÔ∏è</span><div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white px-2 py-1 rounded-md shadow text-[10px] sm:text-xs font-semibold whitespace-nowrap">‡πÄ‡∏Å‡∏≤‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏ô‡πâ‡∏≥</div></div>
                </div>
            </div>
            <div class="text-center mt-6 flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4"><button id="goto-creation-btn" class="w-full sm:w-auto bg-gray-400 text-white font-bold py-3 px-8 rounded-lg cursor-not-allowed" disabled>‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î</button><button id="goto-matching-btn" class="w-full sm:w-auto bg-gray-400 text-white font-bold py-3 px-8 rounded-lg cursor-not-allowed" disabled>‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</button></div>
        </div>
        
        <div id="exploration-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÇ‡∏ã‡∏ô <span id="zone-name" class="text-green-600"></span></h2><p class="text-center text-gray-600 mb-6">‡πÉ‡∏ä‡πâ Mangrove Explorer App ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</p>
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg text-center">
                <div id="scanner-animation" class="w-40 h-40 sm:w-48 sm:h-48 mx-auto rounded-full flex items-center justify-center mb-4 relative overflow-hidden bg-gray-800 border-4 border-gray-600 shadow-inner">
                    <div id="scanner-display"><div class="absolute w-full h-px bg-green-400/50 top-1/2 -translate-y-1/2"></div><div class="absolute h-full w-px bg-green-400/50 left-1/2 -translate-x-1/2"></div><div class="w-1/3 h-1/3 bg-green-400 rounded-full scanner-lens" style="box-shadow: 0 0 15px rgba(52, 211, 153, 0.8);"></div><div class="scanner-line absolute w-full h-1/2 top-0 left-0 bg-gradient-to-b from-green-400/70 to-transparent" style="transform-origin: 50% 100%;"></div></div>
                </div>
                <button id="scan-plant-btn" class="bg-blue-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg hover:bg-blue-700 transition-colors">‡∏™‡πÅ‡∏Å‡∏ô‡∏û‡∏∑‡∏ä</button>
            </div>
            <div class="mt-8"><h3 class="text-xl sm:text-2xl font-bold mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ (<span id="plant-count">0</span>/2)</h3><div id="collected-data-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div></div>
            <div class="text-center mt-6"><button id="back-to-map-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button></div>
        </div>

        <div id="matching-game-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ: ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏û‡∏∑‡∏ä</h2><p class="text-center text-gray-600 mb-6">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (<span id="matches-found">0</span>/<span id="total-matches">0</span>)</p>
            <div class="flex flex-col md:flex-row gap-6 justify-center"><div class="w-full md:w-1/3"><h3 class="font-bold text-lg mb-2 text-center">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä</h3><div id="match-plants-container" class="space-y-3"></div></div><div class="w-full md:w-1/3"><h3 class="font-bold text-lg mb-2 text-center">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥/‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h3><div id="match-props-container" class="space-y-3"></div></div></div>
            <div class="text-center mt-8"><button id="back-to-map-from-match-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button></div>
        </div>

        <div id="creation-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2: The Creator</h2><p class="text-center text-gray-600 mb-6">‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 2 ‡πÉ‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏°‡∏≤‡∏ú‡∏™‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏° (‡∏™‡∏£‡πâ‡∏≤‡∏á <span id="idea-count">0</span>/3 ‡∏ä‡∏¥‡πâ‡∏ô)</p>
            <div class="flex flex-col md:flex-row gap-6"><div class="md:w-1/3"><h3 class="text-xl font-bold mb-3">‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä</h3><div id="creation-data-container" class="space-y-3 max-h-[250px] md:max-h-[400px] overflow-y-auto pr-2"></div></div><div class="md:w-2/3 bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-bold mb-3">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ú‡∏™‡∏°‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢</h3><p class="text-sm text-gray-500 mb-4">‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä 2 ‡πÉ‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p><div class="flex items-center justify-center gap-4 mb-4"><div id="combo-slot-1" class="combo-slot w-1/2 h-28 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 p-2 text-center">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1</div><span class="text-2xl font-bold text-gray-500">+</span><div id="combo-slot-2" class="combo-slot w-1/2 h-28 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 p-2 text-center">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2</div></div><div id="idea-input-section" class="hidden animate-fade-in-up"><p class="text-center font-semibold mb-2">‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à: <span id="combo-inspiration" class="text-green-600"></span></p><div class="space-y-2 p-4 bg-green-50 rounded-lg"><input type="text" id="idea-name-input" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ..." class="w-full px-4 py-2 border rounded-lg"><textarea id="idea-desc-input" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î..." rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea><button id="add-idea-btn" class="w-full bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î</button></div></div><div class="mt-6"><h4 class="font-semibold">‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß:</h4><div id="idea-list-container" class="mt-2 space-y-2"></div></div></div></div>
            <div class="text-center mt-6"><button id="goto-presentation-btn" class="bg-gray-400 text-white font-bold py-3 px-8 rounded-lg cursor-not-allowed" disabled>‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢</button></div>
        </div>

        <div id="presentation-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 3: The Presenter</h2><p class="text-center text-gray-600 mb-6">‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢ ‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏ß‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ (<span id="votes-left-display">3</span> ‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠)</p>
            <div id="idea-market-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div class="text-center mt-6"><button id="goto-idea-match-btn" class="bg-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-purple-700">‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</button></div>
        </div>

        <div id="idea-matching-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à</h2><p class="text-center text-gray-600 mb-6">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (<span id="idea-matches-found">0</span>/<span id="total-idea-matches">0</span>)</p>
            <div class="flex flex-col md:flex-row gap-6 justify-center"><div class="w-full md:w-1/3"><h3 class="font-bold text-lg mb-2 text-center">‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</h3><div id="match-ideas-container" class="space-y-3"></div></div><div class="w-full md:w-1/3"><h3 class="font-bold text-lg mb-2 text-center">‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡∏ä</h3><div id="match-inspirations-container" class="space-y-3"></div></div></div>
            <div class="text-center mt-8"><button id="goto-evaluation-btn" class="bg-gray-400 text-white font-bold py-3 px-8 rounded-lg cursor-not-allowed" disabled>‡∏î‡∏π‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button></div>
        </div>

        <div id="evaluation-screen" class="game-screen text-center">
            <h2 class="text-2xl sm:text-3xl font-bold text-green-700 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h2><p class="text-gray-600 mb-8">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            <div class="bg-white p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold mb-6">Badges ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h3><div id="badge-container" class="flex justify-center items-center flex-wrap gap-4 sm:gap-8"></div><div class="mt-8 border-t pt-8"><h3 class="text-2xl font-bold mb-4">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: The Reflecter</h3><p class="text-gray-600 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</p><textarea id="reflection-input" placeholder="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á..." rows="4" class="w-full max-w-lg mx-auto px-4 py-2 border rounded-lg"></textarea></div><div class="text-center mt-6"><button id="finish-game-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏π Portfolio</button></div></div>
        </div>
        
        <div id="portfolio-screen" class="game-screen">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6">Digital Portfolio ‡∏Ç‡∏≠‡∏á <span id="portfolio-player-name" class="text-green-600"></span></h2>
            <div class="bg-white p-8 rounded-xl shadow-lg"><div class="mb-6"><h3 class="text-xl font-bold border-b pb-2 mb-3">‡∏ï‡∏£‡∏≤‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3><div id="portfolio-badge-container" class="flex gap-4 flex-wrap"></div></div><div class="mb-6"><h3 class="text-xl font-bold border-b pb-2 mb-3">‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</h3><div id="portfolio-idea-container" class="space-y-3"></div></div><div class="mb-6"><h3 class="text-xl font-bold border-b pb-2 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö</h3><div id="portfolio-data-container" class="space-y-3"></div></div><div><h3 class="text-xl font-bold border-b pb-2 mb-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h3><p id="portfolio-reflection" class="bg-yellow-100 p-4 rounded-lg text-yellow-800"></p></div></div>
            <div class="text-center mt-8 flex flex-col sm:flex-row justify-center gap-4"><button id="save-data-btn" class="w-full sm:w-auto bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏á‡∏ä‡∏µ‡∏ï</button><button onclick="sfx.play('click'); location.reload();" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button></div>
        </div>
    </div>

    <script>
        // --- GAME SETUP AND STATE MANAGEMENT ---
        const SCREENS = { WELCOME: 'welcome-screen', MAP: 'map-screen', EXPLORATION: 'exploration-screen', MATCHING_GAME: 'matching-game-screen', CREATION: 'creation-screen', PRESENTATION: 'presentation-screen', IDEA_MATCHING: 'idea-matching-screen', EVALUATION: 'evaluation-screen', PORTFOLIO: 'portfolio-screen' };
        let gameState = { playerName: '', avatar: null, currentScreen: SCREENS.WELCOME, skills: { observation: { level: 1, xp: 0 }, analysis: { level: 1, xp: 0 }, creativity: { level: 1, xp: 0 }, }, collectedData: [], createdIdeas: [], badges: [], reflection: '', votesLeft: 3 };
        const PLANT_DATABASE = { Morphology: [ { id: 1, name: '‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å', property: '‡∏£‡∏≤‡∏Å‡∏Ñ‡πâ‡∏≥‡∏à‡∏∏‡∏ô', description: '‡∏°‡∏µ‡∏£‡∏≤‡∏Å‡∏Ñ‡πâ‡∏≥‡∏à‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏°‡∏µ‡∏™‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏ô‡∏¥‡∏ô (Tannin) ‡∏™‡∏π‡∏á ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πâ', potential: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å', cssClass: 'plant-‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏•‡πá‡∏Å' }, { id: 2, name: '‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏•', property: '‡πÉ‡∏ö‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡∏∑‡∏≠', description: '‡∏ú‡∏¥‡∏ß‡πÉ‡∏ö‡∏´‡∏ô‡∏≤ ‡∏°‡∏±‡∏ô‡∏ß‡∏≤‡∏ß ‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏°‡∏Ç‡∏±‡∏ö‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ (salt glands) ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Active Transport ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô', potential: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á, ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏™‡∏≤‡∏£', cssClass: 'plant-‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏•' }, { id: 3, name: '‡∏ï‡∏∞‡∏ö‡∏π‡∏ô‡∏Ç‡∏≤‡∏ß', property: '‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏≥‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö', description: '‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏±‡∏ô ‡∏°‡∏µ‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏¥‡πÇ‡∏°‡∏ô‡∏≠‡∏¢‡∏î‡πå (limonoids) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏•‡πà‡πÅ‡∏°‡∏•‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏£‡∏µ‡∏¢‡∏á', potential: '‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ú‡∏¥‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏£‡∏µ‡∏¢‡∏á', cssClass: '' }, ], Property: [ { id: 4, name: '‡∏à‡∏≤‡∏Å', property: '‡πÉ‡∏ö‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡∏ç‡πà', description: '‡πÉ‡∏ö‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏¢‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°', potential: '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏´‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°, ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå', cssClass: '' }, { id: 5, name: '‡∏ï‡∏µ‡∏ô‡πÄ‡∏õ‡πá‡∏î‡∏ó‡∏∞‡πÄ‡∏•', property: '‡∏¢‡∏≤‡∏á‡∏°‡∏µ‡∏û‡∏¥‡∏©', description: '‡∏¢‡∏≤‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ñ‡∏≤‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡πÑ‡∏Å‡∏•‡πÇ‡∏Ñ‡πÑ‡∏ã‡∏î‡πå (cardiac glycoside) ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏°‡∏•‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡πá‡∏Å', potential: '‡∏™‡∏≤‡∏£‡πÑ‡∏•‡πà‡πÅ‡∏°‡∏•‡∏á‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û', cssClass: '' }, { id: 6, name: '‡∏ù‡∏≤‡∏î‡∏î‡∏≠‡∏Å‡∏Ç‡∏≤‡∏ß', property: '‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏µ‡πÅ‡∏ó‡∏ô‡∏ô‡∏¥‡∏ô‡∏™‡∏π‡∏á', description: '‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏°‡∏µ‡∏™‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏ô‡∏¥‡∏ô (Tannin) ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏û‡∏•‡∏µ‡∏ü‡∏µ‡∏ô‡∏≠‡∏• ‡πÉ‡∏´‡πâ‡∏£‡∏™‡∏ù‡∏≤‡∏î ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏™‡∏µ‡∏¢‡πâ‡∏≠‡∏°‡πÑ‡∏î‡πâ', potential: '‡∏™‡∏µ‡∏¢‡πâ‡∏≠‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥, ‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡∏ö‡∏π‡∏î', cssClass: '' }, ], Behavior: [ { id: 7, name: '‡∏•‡∏≥‡∏û‡∏π', property: '‡∏£‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à', description: '‡∏°‡∏µ‡∏£‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à (pneumatophores) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ü‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡πä‡∏≤‡∏ã‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡∏Ç‡∏≤‡∏î‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô', potential: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏≠‡∏≤‡∏Å‡∏≤‡∏®', cssClass: '' }, { id: 8, name: '‡πÇ‡∏õ‡∏£‡∏á‡πÅ‡∏î‡∏á', property: '‡∏ù‡∏±‡∏Å‡∏á‡∏≠‡∏Å‡∏ö‡∏ô‡∏ï‡πâ‡∏ô', description: '‡πÄ‡∏°‡∏•‡πá‡∏î‡∏á‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ù‡∏±‡∏Å‡∏¢‡∏≤‡∏ß‡πÅ‡∏´‡∏•‡∏° (vivipary) ‡∏Ç‡∏ì‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏°‡πà ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡πà‡∏ß‡∏á‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏∞‡∏õ‡∏±‡∏Å‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', potential: '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å, ‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', cssClass: '' }, { id: 9, name: '‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á', property: '‡∏î‡∏≠‡∏Å‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏°‡∏µ‡∏´‡∏ô‡∏≤‡∏°', description: '‡πÉ‡∏ö‡∏°‡∏µ‡∏´‡∏ô‡∏≤‡∏°‡πÅ‡∏´‡∏•‡∏°‡∏Ñ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏£‡∏≤‡∏Å‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö Icariside C3 ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö', potential: '‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô, ‡∏™‡∏≤‡∏£‡∏ï‡πâ‡∏≤‡∏ô‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö', cssClass: 'plant-‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏î‡∏≠‡∏Å‡∏°‡πà‡∏ß‡∏á' }, ] };
        const DUMMY_IDEAS = [ { id: 101, name: '‡πÇ‡∏î‡∏£‡∏ô‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏°‡∏•‡πá‡∏î‡πÇ‡∏õ‡∏£‡∏á‡πÅ‡∏î‡∏á', description: '‡πÇ‡∏î‡∏£‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏•‡∏á‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô', author: '‡∏ó‡∏µ‡∏°‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£ Alpha', votes: 0, inspiration: '‡∏ù‡∏±‡∏Å‡∏á‡∏≠‡∏Å‡∏ö‡∏ô‡∏ï‡πâ‡∏ô', inspirationDesc: '‡πÄ‡∏°‡∏•‡πá‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏á‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏á‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ù‡∏±‡∏Å‡∏¢‡∏≤‡∏ß‡πÅ‡∏´‡∏•‡∏°‡∏Ç‡∏ì‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏°‡πà ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡πà‡∏ß‡∏á‡∏´‡∏•‡πà‡∏ô‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏±‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏£‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ "‡∏õ‡∏±‡∏Å" ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∂‡∏î‡πÄ‡∏Å‡∏≤‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' }, { id: 102, name: '‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏Å‡∏•‡∏≥‡∏û‡∏π', description: '‡πÅ‡∏ú‡πà‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à', author: '‡∏ó‡∏µ‡∏°‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£ Beta', votes: 0, inspiration: '‡∏£‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à', inspirationDesc: '‡∏£‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏•‡∏≥‡∏û‡∏π‡∏ó‡∏µ‡πà‡πÇ‡∏ú‡∏•‡πà‡∏û‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏û‡∏£‡∏∏‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏ß‡∏™‡∏π‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏ù‡∏∏‡πà‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û' }, ];
        const BADGE_INFO = { 'üå± Nature Observer': { icon: 'üå±', text: '‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥' }, 'üå≥ Creative Innovator': { icon: 'üå≥', text: '‡∏ô‡∏±‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå' }, 'üåè Eco Hero': { icon: 'üåè', text: '‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡∏£‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏•‡∏Å' }, 'üåä Master Explorer': { icon: 'üåä', text: '‡∏à‡πâ‡∏≤‡∏ß‡πÅ‡∏´‡πà‡∏á‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à' }, '‚ôªÔ∏è Circular Thinker': { icon: '‚ôªÔ∏è', text: '‡∏ô‡∏±‡∏Å‡∏Ñ‡∏¥‡∏î‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô' }, };
        const AVATARS = [ { id: 'avatar-1', cssClass: 'avatar-1' }, { id: 'avatar-2', cssClass: 'avatar-2' }, { id: 'avatar-3', cssClass: 'avatar-3' }, { id: 'avatar-4', cssClass: 'avatar-4' }, ];
        const RANDOM_EVENTS = [ { title: '‚ú® ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© ‚ú®', text: '‡∏û‡∏≤‡∏¢‡∏∏‡πÄ‡∏Ç‡πâ‡∏≤! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÇ‡∏Å‡∏á‡∏Å‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏¢‡∏¢‡∏∂‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô', skill: 'analysis', xp: 15 }, { title: '‚ú® ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© ‚ú®', text: '‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡∏π‡∏á! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏™‡∏°‡∏ó‡∏∞‡πÄ‡∏•‡∏Ç‡∏±‡∏ö‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ ‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á', skill: 'analysis', xp: 15 }, { title: '‚ú® ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© ‚ú®', text: '‡∏û‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏´‡∏≤‡∏¢‡∏≤‡∏Å! ‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡∏û‡∏á‡∏õ‡πà‡∏≤‡∏ä‡∏≤‡∏¢‡πÄ‡∏•‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥', skill: 'creativity', xp: 10 } ];
        let audioCtx; const sfx = { init() { if (!audioCtx) { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } }, play(soundName) { if (!audioCtx) return; const now = audioCtx.currentTime; let osc = audioCtx.createOscillator(), gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); switch(soundName) { case 'click': osc.type = 'triangle'; osc.frequency.setValueAtTime(880, now); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.1); osc.start(now); osc.stop(now + 0.1); break; case 'success': osc.type = 'sine'; osc.frequency.setValueAtTime(523.25, now); osc.frequency.linearRampToValueAtTime(1046.50, now + 0.2); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.2); osc.start(now); osc.stop(now + 0.2); break; case 'error': osc.type = 'square'; osc.frequency.setValueAtTime(150, now); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.2); osc.start(now); osc.stop(now + 0.2); break; case 'scan': osc.type = 'sawtooth'; gain.gain.setValueAtTime(0.08, now); osc.frequency.setValueAtTime(300, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 1.2); gain.gain.exponentialRampToValueAtTime(0.0001, now + 1.4); osc.start(now); osc.stop(now + 1.4); break; case 'levelUp': ['C5', 'E5', 'G5'].forEach((note, i) => { const freqs = { C5: 523.25, E5: 659.25, G5: 783.99 }; const time = now + i * 0.1; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type = 'triangle'; o.frequency.setValueAtTime(freqs[note], time); g.gain.setValueAtTime(0.1, time); g.gain.exponentialRampToValueAtTime(0.0001, time + 0.1); o.start(time); o.stop(time + 0.1); }); break; } } };
        const gameHeader = document.getElementById('game-header'); const allScreens = document.querySelectorAll('.game-screen'); const professorModal = document.getElementById('professor-modal');
        function showNotification(message, icon = '‚≠ê') { const container = document.getElementById('notification-container'); const notif = document.createElement('div'); notif.className = 'notification bg-white rounded-lg shadow-lg p-4 flex items-center gap-3 border-l-4 border-green-500'; notif.innerHTML = `<span class="text-2xl">${icon}</span><span class="font-semibold text-gray-700">${message}</span>`; container.appendChild(notif); setTimeout(() => { notif.remove(); }, 4000); if (icon.includes('‚úÖ') || icon.includes('üöÄ') || icon.includes('üåø')) sfx.play('success'); else if (icon.includes('‚ùå')) sfx.play('error'); }
        function switchScreen(screenId) { allScreens.forEach(screen => screen.classList.remove('active-screen')); document.getElementById(screenId).classList.add('active-screen'); gameState.currentScreen = screenId; if (screenId === SCREENS.MAP && Math.random() < 0.25) { const event = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)]; setTimeout(() => { showProfessorMessage(event.text, () => { const skillName = { analysis: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', creativity: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå' }[event.skill]; addXP(event.skill, event.xp); showNotification(`‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö +${event.xp} XP ‡∏î‡πâ‡∏≤‡∏ô${skillName}!`, '‚ú®'); }, event.title); }, 500); } if (screenId !== SCREENS.WELCOME) gameHeader.classList.remove('hidden'); saveGameState(); }
        function showProfessorMessage(message, onContinue, title = "‡∏™‡∏≤‡∏£‡∏à‡∏≤‡∏Å ‡∏®.‡∏≠‡∏£‡∏£‡∏ñ‡∏ä‡∏±‡∏¢") { document.getElementById('professor-title').textContent = title; document.getElementById('professor-message').textContent = message; professorModal.classList.remove('hidden'); const newBtn = document.getElementById('professor-continue-btn').cloneNode(true); document.getElementById('professor-continue-btn').parentNode.replaceChild(newBtn, document.getElementById('professor-continue-btn')); newBtn.addEventListener('click', () => { professorModal.classList.add('hidden'); if (onContinue) onContinue(); sfx.play('click'); }, { once: true }); }
        function addXP(skill, amount) { const skillData = gameState.skills[skill]; skillData.xp += amount; if (skillData.xp >= 100) { skillData.level++; skillData.xp -= 100; const skillName = { observation: '‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï', analysis: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', creativity: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå' }[skill]; showNotification(`Level Up! ‡∏™‡∏Å‡∏¥‡∏•${skillName}‡πÄ‡∏õ‡πá‡∏ô Lv. ${skillData.level}`, 'üöÄ'); sfx.play('levelUp'); } updateHeaderUI(); }
        function awardBadge(badge) { if (!gameState.badges.includes(badge)) { gameState.badges.push(badge); const info = BADGE_INFO[badge]; if (info) showNotification(`‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Badge: ${info.text}`, info.icon); } }
        function saveGameState() { localStorage.setItem('mangroveQuestState', JSON.stringify(gameState)); }
        function loadGameState() { const savedState = localStorage.getItem('mangroveQuestState'); if (savedState) { gameState = JSON.parse(savedState); document.getElementById('player-name-input').value = gameState.playerName; updateHeaderUI(); renderCollectedData(); renderCreatedIdeas(); checkQuestCompletion(); switchScreen(gameState.currentScreen); return true; } return false; }
        function updateHeaderUI() { document.getElementById('player-name-display').textContent = gameState.playerName; const headerAvatar = document.getElementById('header-avatar'); headerAvatar.className = 'w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-md flex-shrink-0'; headerAvatar.textContent = ''; const selectedAvatar = AVATARS.find(a => a.id === gameState.avatar); if (selectedAvatar) { headerAvatar.classList.add('avatar', selectedAvatar.cssClass); } else { headerAvatar.classList.add('bg-gray-400'); headerAvatar.textContent = gameState.playerName.charAt(0).toUpperCase() || '?'; } document.getElementById('obs-lvl').textContent = gameState.skills.observation.level; document.getElementById('obs-xp').textContent = gameState.skills.observation.xp; document.getElementById('anl-lvl').textContent = gameState.skills.analysis.level; document.getElementById('anl-xp').textContent = gameState.skills.analysis.xp; document.getElementById('crt-lvl').textContent = gameState.skills.creativity.level; document.getElementById('crt-xp').textContent = gameState.skills.creativity.xp; }
        function renderCollectedData() { const container = document.getElementById('collected-data-container'), creationContainer = document.getElementById('creation-data-container'); container.innerHTML = ''; creationContainer.innerHTML = ''; const baseCardHTML = (plant) => `<h4 class="font-bold text-lg text-green-700">${plant.name}</h4><p class="text-sm font-semibold">${plant.property}</p><p class="text-xs text-gray-600 mt-1">${plant.description}</p>`; gameState.collectedData.forEach(plant => { const card = document.createElement('div'); card.className = "plant-card bg-white p-4 rounded-lg shadow"; card.innerHTML = baseCardHTML(plant); container.appendChild(card); }); gameState.collectedData.forEach(plant => { const card = document.createElement('div'); card.className = "plant-card plant-card-draggable bg-white p-4 rounded-lg shadow"; card.innerHTML = baseCardHTML(plant); card.setAttribute('draggable', true); card.dataset.plantId = plant.id; creationContainer.appendChild(card); }); document.getElementById('plant-count').textContent = gameState.collectedData.length; }
        function renderCreatedIdeas() { const container = document.getElementById('idea-list-container'); container.innerHTML = ''; gameState.createdIdeas.forEach((idea, index) => { container.innerHTML += `<div class="bg-gray-100 p-2 rounded-md"><div class="flex justify-between items-center"><p class="text-sm font-semibold">${idea.name}</p><button class="remove-idea-btn text-red-500 text-xs" data-index="${index}">‡∏•‡∏ö</button></div><p class="text-xs text-gray-500 mt-1">‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à: ${idea.inspiredBy.join(' + ')}</p></div>`; }); document.getElementById('idea-count').textContent = gameState.createdIdeas.length; document.querySelectorAll('.remove-idea-btn').forEach(btn => { btn.addEventListener('click', (e) => { const indexToRemove = parseInt(e.target.dataset.index); gameState.createdIdeas.splice(indexToRemove, 1); renderCreatedIdeas(); checkQuestCompletion(); saveGameState(); sfx.play('click'); }); }); }
        function checkQuestCompletion() { const gotoCreationBtn = document.getElementById('goto-creation-btn'), gotoMatchingBtn = document.getElementById('goto-matching-btn'), gotoPresentationBtn = document.getElementById('goto-presentation-btn'); if(gameState.collectedData.length >= 2) { gotoCreationBtn.disabled = false; gotoCreationBtn.classList.remove('bg-gray-400', 'cursor-not-allowed'); gotoCreationBtn.classList.add('bg-green-600', 'hover:bg-green-700'); awardBadge('üå± Nature Observer'); } else { gotoCreationBtn.disabled = true; gotoCreationBtn.classList.add('bg-gray-400', 'cursor-not-allowed'); gotoCreationBtn.classList.remove('bg-green-600', 'hover:bg-green-700'); } if(gameState.collectedData.length >= 3) { gotoMatchingBtn.disabled = false; gotoMatchingBtn.classList.remove('bg-gray-400', 'cursor-not-allowed'); gotoMatchingBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600'); } else { gotoMatchingBtn.disabled = true; gotoMatchingBtn.classList.add('bg-gray-400', 'cursor-not-allowed'); gotoMatchingBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600'); } if(gameState.createdIdeas.length >= 3) { gotoPresentationBtn.disabled = false; gotoPresentationBtn.classList.remove('bg-gray-400', 'cursor-not-allowed'); gotoPresentationBtn.classList.add('bg-blue-600', 'hover:bg-blue-700'); awardBadge('üå≥ Creative Innovator'); } else { gotoPresentationBtn.disabled = true; gotoPresentationBtn.classList.add('bg-gray-400', 'cursor-not-allowed'); gotoPresentationBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700'); } }
        function setupAvatarSelection() { const container = document.getElementById('avatar-selection'); container.innerHTML = ''; AVATARS.forEach(avatar => { const avatarEl = document.createElement('div'); avatarEl.className = `avatar ${avatar.cssClass}`; avatarEl.dataset.avatarId = avatar.id; container.appendChild(avatarEl); }); container.addEventListener('click', e => { const avatarEl = e.target.closest('.avatar'); if (avatarEl) { document.querySelectorAll('.avatar').forEach(a => a.classList.remove('selected')); avatarEl.classList.add('selected'); sfx.play('click'); } }); }
        function initWelcomeScreen() { const startBtn = document.getElementById('start-game-btn'), continueBtn = document.getElementById('continue-game-btn'); startBtn.addEventListener('click', () => { sfx.init(); sfx.play('click'); const playerName = document.getElementById('player-name-input').value.trim(); const selectedAvatarEl = document.querySelector('.avatar.selected'); if (!playerName || !selectedAvatarEl) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß'); sfx.play('error'); return; } gameState = { playerName, avatar: selectedAvatarEl.dataset.avatarId, currentScreen: SCREENS.MAP, skills: { observation: { level: 1, xp: 0 }, analysis: { level: 1, xp: 0 }, creativity: { level: 1, xp: 0 } }, collectedData: [], createdIdeas: [], badges: [], reflection: '', votesLeft: 3 }; updateHeaderUI(); showProfessorMessage(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${playerName}! ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏õ‡πà‡∏≤‡∏ä‡∏≤‡∏¢‡πÄ‡∏•‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ!`, () => { switchScreen(SCREENS.MAP); }); }); continueBtn.addEventListener('click', () => { sfx.init(); sfx.play('click'); loadGameState(); }); }
        function initMapScreen() { document.querySelectorAll('.map-pin').forEach(pin => { pin.addEventListener('click', (e) => { sfx.play('click'); const zone = e.currentTarget.dataset.zone; document.getElementById('zone-name').textContent = zone; switchScreen(SCREENS.EXPLORATION); }); }); document.getElementById('goto-creation-btn').addEventListener('click', (e) => { sfx.play('click'); if (!e.currentTarget.disabled) showProfessorMessage(`‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!`, () => { switchScreen(SCREENS.CREATION); }); }); document.getElementById('goto-matching-btn').addEventListener('click', (e) => { sfx.play('click'); if(!e.currentTarget.disabled) { setupMatchingGame(); switchScreen(SCREENS.MATCHING_GAME); } }); }
        function displayPlantInScanner(plant) { const scannerDisplay = document.getElementById('scanner-display'); if (plant.cssClass) { scannerDisplay.innerHTML = `<div class="css-plant-container ${plant.cssClass}"><div class="trunk"></div><div class="root1"></div><div class="root2"></div><div class="leaves"></div><div class="salt1"></div><div class="salt2"></div><div class="salt3"></div><div class="stem"></div><div class="leaf1"></div><div class="leaf2"></div><div class="flower"></div></div>`; } else { scannerDisplay.innerHTML = `<div class="p-4 text-center text-white flex flex-col justify-center items-center h-full"><p class="text-sm">‡∏û‡∏ö‡∏û‡∏∑‡∏ä‡∏ä‡∏ô‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà:</p><p class="font-bold text-lg text-green-300">${plant.name}</p><p class="text-xs mt-2">${plant.property}</p></div>`; } }
        function resetScannerDisplay(){ document.getElementById('scanner-display').innerHTML = `<div class="absolute w-full h-px bg-green-400/50 top-1/2 -translate-y-1/2"></div><div class="absolute h-full w-px bg-green-400/50 left-1/2 -translate-x-1/2"></div><div class="w-1/3 h-1/3 bg-green-400 rounded-full scanner-lens" style="box-shadow: 0 0 15px rgba(52, 211, 153, 0.8);"></div><div class="scanner-line absolute w-full h-1/2 top-0 left-0 bg-gradient-to-b from-green-400/70 to-transparent" style="transform-origin: 50% 100%;"></div>`; }
        function initExplorationScreen() { document.getElementById('back-to-map-btn').addEventListener('click', () => { sfx.play('click'); resetScannerDisplay(); switchScreen(SCREENS.MAP); }); document.getElementById('scan-plant-btn').addEventListener('click', () => { const scanBtn = document.getElementById('scan-plant-btn'); scanBtn.disabled = true; const scanner = document.getElementById('scanner-animation'); scanner.classList.add('scanner-active'); resetScannerDisplay(); sfx.play('scan'); setTimeout(() => { scanner.classList.remove('scanner-active'); const zone = document.getElementById('zone-name').textContent, availablePlants = PLANT_DATABASE[zone]; if(availablePlants && availablePlants.length > 0) { const uncollectedPlants = availablePlants.filter(p => !gameState.collectedData.some(cp => cp.id === p.id)); if (uncollectedPlants.length > 0) { const newPlant = uncollectedPlants[Math.floor(Math.random() * uncollectedPlants.length)]; gameState.collectedData.push(newPlant); displayPlantInScanner(newPlant); showNotification(`‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö: ${newPlant.name}!`, 'üåø'); renderCollectedData(); addXP('observation', 50); addXP('analysis', 25); checkQuestCompletion(); saveGameState(); } else { alert(`‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏û‡∏∑‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß! ‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏ã‡∏ô‡∏≠‡∏∑‡πà‡∏ô`); sfx.play('error'); } } scanBtn.disabled = false; }, 1500); }); }
        let comboSlotData = [null, null];
        function initCreationScreen() { const ideaInputSection = document.getElementById('idea-input-section'), slots = [document.getElementById('combo-slot-1'), document.getElementById('combo-slot-2')]; function resetComboBoard() { comboSlotData = [null, null]; slots.forEach((slot, i) => { slot.innerHTML = `‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà ${i+1}`; slot.dataset.plantId = ''; }); ideaInputSection.classList.add('hidden'); document.getElementById('idea-name-input').value = ''; document.getElementById('idea-desc-input').value = ''; } document.getElementById('creation-data-container').addEventListener('dragstart', e => { if (e.target.classList.contains('plant-card-draggable')) e.dataTransfer.setData('text/plain', e.target.dataset.plantId); }); slots.forEach((slot, index) => { slot.addEventListener('dragover', e => { e.preventDefault(); slot.classList.add('drag-over'); }); slot.addEventListener('dragleave', () => slot.classList.remove('drag-over')); slot.addEventListener('drop', e => { e.preventDefault(); slot.classList.remove('drag-over'); const plantId = e.dataTransfer.getData('text/plain'), plant = gameState.collectedData.find(p => p.id == plantId); if (plant) { comboSlotData[index] = plant; slot.innerHTML = `<p class="font-semibold text-sm">${plant.name}</p><p class="text-xs text-gray-600">${plant.property}</p>`; slot.dataset.plantId = plant.id; } if (comboSlotData[0] && comboSlotData[1]) { document.getElementById('combo-inspiration').textContent = `${comboSlotData[0].property} + ${comboSlotData[1].property}`; document.getElementById('idea-desc-input').placeholder = '‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î... (‡∏•‡∏≠‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï)'; ideaInputSection.classList.remove('hidden'); } }); }); document.getElementById('add-idea-btn').addEventListener('click', () => { sfx.play('click'); const ideaName = document.getElementById('idea-name-input').value.trim(), ideaDesc = document.getElementById('idea-desc-input').value.trim(); if (ideaName && ideaDesc && comboSlotData[0] && comboSlotData[1]) { gameState.createdIdeas.push({ id: Date.now(), name: ideaName, description: ideaDesc, author: gameState.playerName, votes: 0, inspiredBy: [comboSlotData[0].name, comboSlotData[1].name] }); renderCreatedIdeas(); addXP('creativity', 40); checkQuestCompletion(); resetComboBoard(); saveGameState(); } else { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 2 ‡πÉ‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); sfx.play('error'); } }); document.getElementById('goto-presentation-btn').addEventListener('click', (e) => { sfx.play('click'); if (!e.currentTarget.disabled) showProfessorMessage(`‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢! ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏õ‡∏î‡∏π‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏à‡∏∞‡∏ä‡∏≠‡∏ö‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÑ‡∏´‡∏ô!`, () => { setupPresentationScreen(); switchScreen(SCREENS.PRESENTATION); }); }); }
        function setupMatchingGame() { const plantsContainer = document.getElementById('match-plants-container'), propsContainer = document.getElementById('match-props-container'); plantsContainer.innerHTML = ''; propsContainer.innerHTML = ''; const gameData = gameState.collectedData.slice(0, 4); document.getElementById('total-matches').textContent = gameData.length; document.getElementById('matches-found').textContent = 0; let propsData = [...gameData]; propsData.sort(() => Math.random() - 0.5); gameData.forEach(plant => { plantsContainer.innerHTML += `<div class="match-item p-3 bg-white rounded-lg border-2 border-gray-200" data-id="${plant.id}">${plant.name}</div>`; }); propsData.forEach(prop => { propsContainer.innerHTML += `<div class="match-item p-3 bg-white rounded-lg border-2 border-gray-200" data-id="${prop.id}">${prop.property}</div>`; }); let selectedPlant = null, selectedProp = null, matchesFound = 0; document.querySelectorAll('#matching-game-screen .match-item').forEach(item => { item.addEventListener('click', (e) => { const clickedItem = e.currentTarget; if(clickedItem.classList.contains('matched')) return; sfx.play('click'); const parentId = clickedItem.parentElement.id; if (parentId === 'match-plants-container') { document.querySelectorAll('#match-plants-container .match-item').forEach(i => i.classList.remove('selected')); clickedItem.classList.add('selected'); selectedPlant = clickedItem; } else if (parentId === 'match-props-container') { document.querySelectorAll('#match-props-container .match-item').forEach(i => i.classList.remove('selected')); clickedItem.classList.add('selected'); selectedProp = clickedItem; } if (selectedPlant && selectedProp) { if (selectedPlant.dataset.id === selectedProp.dataset.id) { selectedPlant.classList.add('matched'); selectedProp.classList.add('matched'); matchesFound++; document.getElementById('matches-found').textContent = matchesFound; addXP('analysis', 30); showNotification('‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', '‚úÖ'); if (matchesFound === gameData.length) showProfessorMessage(`‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏£‡∏±‡∏ö XP ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢!`, () => { switchScreen(SCREENS.MAP); }); } else { showNotification('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‚ùå'); } setTimeout(() => { selectedPlant?.classList.remove('selected'); selectedProp?.classList.remove('selected'); selectedPlant = null; selectedProp = null; }, 500); } }); }); }
        function setupPresentationScreen() { const container = document.getElementById('idea-market-container'), votesLeftDisplay = document.getElementById('votes-left-display'); votesLeftDisplay.textContent = gameState.votesLeft; container.innerHTML = ''; const allIdeas = [...gameState.createdIdeas, ...DUMMY_IDEAS]; allIdeas.sort(() => Math.random() - 0.5); allIdeas.forEach(idea => { const card = document.createElement('div'); card.className = 'idea-card bg-white p-6 rounded-lg shadow'; card.innerHTML = `<h4 class="font-bold text-lg text-blue-700">${idea.name}</h4><p class="text-xs text-gray-500 mb-2">‡πÇ‡∏î‡∏¢: ${idea.author}</p><p class="text-sm text-gray-700 h-20 overflow-y-auto">${idea.description}</p><div class="mt-4 pt-4 border-t flex justify-between items-center"><button class="vote-btn bg-yellow-400 text-yellow-900 font-semibold py-1 px-3 rounded-full hover:bg-yellow-500 transition-colors" data-id="${idea.id}">‚≠ê ‡πÇ‡∏´‡∏ß‡∏ï</button><span class="font-bold text-lg" id="votes-${idea.id}">${idea.votes}</span></div>`; container.appendChild(card); }); document.querySelectorAll('.vote-btn').forEach(btn => { btn.addEventListener('click', (e) => { sfx.play('click'); if (gameState.votesLeft > 0) { gameState.votesLeft--; votesLeftDisplay.textContent = gameState.votesLeft; addXP('creativity', 15); const id = e.target.dataset.id, voteSpan = document.getElementById(`votes-${id}`); voteSpan.textContent = parseInt(voteSpan.textContent) + 1; e.target.disabled = true; e.target.textContent = '‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß!'; e.target.classList.remove('bg-yellow-400', 'hover:bg-yellow-500'); e.target.classList.add('bg-gray-300', 'cursor-not-allowed'); if(gameState.votesLeft === 0) document.querySelectorAll('.vote-btn:not(:disabled)').forEach(b => { b.disabled = true; b.classList.add('bg-gray-300', 'cursor-not-allowed'); b.textContent = '‡πÇ‡∏´‡∏ß‡∏ï‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß' }); } }); }); }
        function setupIdeaMatchingScreen() { const ideasContainer = document.getElementById('match-ideas-container'), inspirationsContainer = document.getElementById('match-inspirations-container'); ideasContainer.innerHTML = ''; inspirationsContainer.innerHTML = ''; let gameData = [...DUMMY_IDEAS]; if (gameState.createdIdeas.length > 0) { const playerIdea = { ...gameState.createdIdeas[0], id: `player_${gameState.createdIdeas[0].id}` }; playerIdea.inspiration = playerIdea.inspiredBy.join(' + '); playerIdea.inspirationDesc = `‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏ú‡∏™‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á ${playerIdea.inspiredBy[0]} ‡πÅ‡∏•‡∏∞ ${playerIdea.inspiredBy[1]} ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô`; gameData.push(playerIdea); } document.getElementById('total-idea-matches').textContent = gameData.length; document.getElementById('idea-matches-found').textContent = 0; let inspirationsData = gameData.map(idea => ({ id: idea.id, inspiration: idea.inspiration })); inspirationsData.sort(() => Math.random() - 0.5); gameData.forEach(idea => { ideasContainer.innerHTML += `<div class="match-item p-3 bg-white rounded-lg border-2 border-gray-200" data-id="${idea.id}">${idea.name}</div>`; }); inspirationsData.forEach(insp => { inspirationsContainer.innerHTML += `<div class="match-item p-3 bg-white rounded-lg border-2 border-gray-200" data-id="${insp.id}">${insp.inspiration}</div>`; }); let selectedIdea = null, selectedInspiration = null, matchesFound = 0; document.querySelectorAll('#idea-matching-screen .match-item').forEach(item => { item.addEventListener('click', (e) => { const clickedItem = e.currentTarget; if(clickedItem.classList.contains('matched')) return; sfx.play('click'); const parentId = clickedItem.parentElement.id; if (parentId === 'match-ideas-container') { document.querySelectorAll('#match-ideas-container .match-item').forEach(i => i.classList.remove('selected')); clickedItem.classList.add('selected'); selectedIdea = clickedItem; } else if (parentId === 'match-inspirations-container') { document.querySelectorAll('#match-inspirations-container .match-item').forEach(i => i.classList.remove('selected')); clickedItem.classList.add('selected'); selectedInspiration = clickedItem; } if (selectedIdea && selectedInspiration) { if (selectedIdea.dataset.id === selectedInspiration.dataset.id) { selectedIdea.classList.add('matched'); selectedInspiration.classList.add('matched'); matchesFound++; document.getElementById('idea-matches-found').textContent = matchesFound; addXP('analysis', 20); const matchedIdea = gameData.find(idea => idea.id == selectedIdea.dataset.id); showProfessorMessage(matchedIdea.inspirationDesc, null, `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!`); if (matchesFound === gameData.length) { const btn = document.getElementById('goto-evaluation-btn'); btn.disabled = false; btn.classList.remove('bg-gray-400', 'cursor-not-allowed'); btn.classList.add('bg-purple-600', 'hover:bg-purple-700'); } } else { showNotification('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‚ùå'); } setTimeout(() => { selectedIdea?.classList.remove('selected'); selectedInspiration?.classList.remove('selected'); selectedIdea = null; selectedInspiration = null; }, 500); } }); }); }
        function setupEvaluationScreen() { const container = document.getElementById('badge-container'); container.innerHTML = ''; const myHighestVotedIdea = gameState.createdIdeas.reduce((max, idea) => { const votes = parseInt(document.getElementById(`votes-${idea.id}`)?.textContent || '0'); return votes > max.votes ? { ...idea, votes } : max; }, { votes: -1 }); if (myHighestVotedIdea.votes > 0) awardBadge('üå≥ Creative Innovator'); gameState.createdIdeas.forEach(idea => { if (idea.description.includes('‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô') || idea.description.includes('‡∏£‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏•‡∏Å')) awardBadge('üåè Eco Hero'); if (idea.description.toLowerCase().includes('circular') || idea.description.includes('‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô')) awardBadge('‚ôªÔ∏è Circular Thinker'); }); const totalPlantsInDB = Object.values(PLANT_DATABASE).reduce((sum, zone) => sum + zone.length, 0); if (gameState.collectedData.length >= totalPlantsInDB) awardBadge('üåä Master Explorer'); if (gameState.badges.length > 0) { gameState.badges.forEach(badgeKey => { const info = BADGE_INFO[badgeKey]; container.innerHTML += `<div class="text-center"><div class="text-6xl">${info.icon}</div><p class="font-semibold mt-2">${info.text}</p></div>`; }); } else { container.innerHTML = `<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Badge ‡πÉ‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ô‡∏µ‡πâ</p>`; } saveGameState(); }
        function setupPortfolioScreen() { document.getElementById('portfolio-player-name').textContent = gameState.playerName; const badgeContainer = document.getElementById('portfolio-badge-container'), ideaContainer = document.getElementById('portfolio-idea-container'), dataContainer = document.getElementById('portfolio-data-container'), reflectionEl = document.getElementById('portfolio-reflection'); badgeContainer.innerHTML = ''; ideaContainer.innerHTML = ''; dataContainer.innerHTML = ''; gameState.badges.forEach(b => { const info = BADGE_INFO[b]; badgeContainer.innerHTML += `<div class="bg-gray-100 p-2 rounded-lg flex items-center gap-2"><span class="text-2xl">${info.icon}</span> <span>${info.text}</span></div>`; }); gameState.createdIdeas.forEach(i => { ideaContainer.innerHTML += `<div class="bg-blue-50 p-3 rounded-lg"><p class="font-semibold">${i.name}</p><p class="text-sm text-gray-600">${i.description}</p></div>`; }); gameState.collectedData.forEach(d => { dataContainer.innerHTML += `<div class="bg-green-50 p-3 rounded-lg"><p class="font-semibold">${d.name}</p><p class="text-sm text-gray-600">${d.property}</p></div>`; }); reflectionEl.textContent = gameState.reflection || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ'; const saveBtn = document.getElementById('save-data-btn'); const newSaveBtn = saveBtn.cloneNode(true); saveBtn.parentNode.replaceChild(newSaveBtn, saveBtn); newSaveBtn.disabled = false; newSaveBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏á‡∏ä‡∏µ‡∏ï'; newSaveBtn.addEventListener('click', () => { newSaveBtn.disabled = true; newSaveBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; const onSaveSuccess = () => { showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‚úÖ'); newSaveBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'; }; const onSaveFailure = (error) => { showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‚ùå'); console.error("Save failed:", error); newSaveBtn.disabled = false; newSaveBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏á‡∏ä‡∏µ‡∏ï'; }; try { if (google && google.script && google.script.run) { google.script.run.withSuccessHandler(onSaveSuccess).withFailureHandler(onSaveFailure).saveGameData(gameState); } else { throw new Error("Google Apps Script API not available."); } } catch (e) { onSaveFailure(e); } }, { once: true }); }
        
        function initializeGame() {
            setupAvatarSelection();
            initWelcomeScreen();
            initMapScreen();
            initExplorationScreen();
            initCreationScreen();
            document.getElementById('back-to-map-from-match-btn').addEventListener('click', () => { sfx.play('click'); switchScreen(SCREENS.MAP); });
            document.getElementById('goto-idea-match-btn').addEventListener('click', () => { sfx.play('click'); showProfessorMessage(`‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡∏î‡∏π‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ ‡∏°‡∏≤‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£`, () => { setupIdeaMatchingScreen(); switchScreen(SCREENS.IDEA_MATCHING); }); });
            document.getElementById('goto-evaluation-btn').addEventListener('click', () => { sfx.play('click'); showProfessorMessage(`‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÑ‡∏õ‡∏î‡∏π‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢`, () => { setupEvaluationScreen(); switchScreen(SCREENS.EVALUATION); }); });
            document.getElementById('finish-game-btn').addEventListener('click', () => { sfx.play('click'); gameState.reflection = document.getElementById('reflection-input').value; setupPortfolioScreen(); switchScreen(SCREENS.PORTFOLIO); });
            if (localStorage.getItem('mangroveQuestState')) { document.getElementById('continue-game-btn').classList.remove('hidden'); document.getElementById('player-name-input').value = JSON.parse(localStorage.getItem('mangroveQuestState')).playerName; }
            switchScreen(SCREENS.WELCOME);
        }

        window.addEventListener('load', initializeGame);
    </script>
</body>
</html>